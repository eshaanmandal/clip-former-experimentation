################################
TOTAL EPOCH:  1
################################
Length of normal dataset:  800
Length of anomaly dataset:  800
Length of unlabelled dataset remaining:  197
Epoch 1



 87%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                      | 174/200 [00:07<00:00, 27.56it/s]

100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 200/200 [00:08<00:00, 24.55it/s]
  0%|                                                                                                                                                                                      | 0/290 [00:00<?, ?it/s]





100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 290/290 [00:08<00:00, 34.45it/s]
AUC score for epoch 1 : 0.8029501438140869
Saving the best model
Best AUC score is 0.8029501438140869
Epoch 2



100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 200/200 [00:06<00:00, 29.09it/s]
train loss = 0.18402404006104917
Performing evaluation of epoch 2




100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 290/290 [00:09<00:00, 29.99it/s]
AUC score for epoch 2 : 0.813930332660675
Saving the best model
Best AUC score is 0.813930332660675
Epoch 3



100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 200/200 [00:07<00:00, 28.36it/s]
train loss = 0.08935072727850639
Performing evaluation of epoch 3




100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 290/290 [00:08<00:00, 33.57it/s]
AUC score for epoch 3 : 0.8196600675582886
Saving the best model
Best AUC score is 0.8196600675582886
Epoch 4



100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 200/200 [00:07<00:00, 25.43it/s]
  0%|                                                                                                                                                                                      | 0/290 [00:00<?, ?it/s]
train loss = 0.06055746724188794




100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 290/290 [00:08<00:00, 33.68it/s]
AUC score for epoch 4 : 0.8201622366905212
Saving the best model
Best AUC score is 0.8201622366905212
Epoch 5



100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 200/200 [00:08<00:00, 24.84it/s]
  0%|                                                                                                                                                                                      | 0/290 [00:00<?, ?it/s]
train loss = 0.045605711778334806





100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 290/290 [00:09<00:00, 29.89it/s]
AUC score for epoch 5 : 0.8193413019180298
Best AUC score is 0.8201622366905212
Epoch 6



 98%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋    | 195/200 [00:05<00:00, 60.61it/s]
train loss = 0.03593524256706587
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 200/200 [00:06<00:00, 31.33it/s]




100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 290/290 [00:08<00:00, 32.60it/s]
AUC score for epoch 6 : 0.828676164150238
Saving the best model
Best AUC score is 0.828676164150238
Epoch 7



100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 200/200 [00:08<00:00, 22.83it/s]
  0%|                                                                                                                                                                                      | 0/290 [00:00<?, ?it/s]
train loss = 0.04678205897085718





100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 290/290 [00:09<00:00, 30.27it/s]
AUC score for epoch 7 : 0.8266183137893677
Best AUC score is 0.828676164150238
Epoch 8



100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 200/200 [00:07<00:00, 27.91it/s]
  0%|                                                                                                                                                                                      | 0/290 [00:00<?, ?it/s]
train loss = 0.03673326702308259




100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 290/290 [00:08<00:00, 34.10it/s]
AUC score for epoch 8 : 0.8267113566398621
Best AUC score is 0.828676164150238
Epoch 9



100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 200/200 [00:07<00:00, 26.32it/s]
train loss = 0.0424588250942179
  0%|                                                                                                                                                                                      | 0/290 [00:00<?, ?it/s]




100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 290/290 [00:08<00:00, 33.03it/s]
AUC score for epoch 9 : 0.8273234963417053
Best AUC score is 0.828676164150238
Epoch 10




100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 200/200 [00:07<00:00, 25.59it/s]
train loss = 0.02395730905147502
Performing evaluation of epoch 10




100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 290/290 [00:09<00:00, 30.28it/s]
  0%|                                                                                                                                                                                      | 0/197 [00:00<?, ?it/s]
AUC score for epoch 10 : 0.8313897252082825
Saving the best model
Best AUC score is 0.8313897252082825
BEST TEST AUC:  0.8313897252082825
Loading the best model

 83%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                             | 163/197 [00:02<00:00, 146.81it/s]
################################
TOTAL EPOCH:  2
################################
Length of normal dataset:  839
Length of anomaly dataset:  839
Length of unlabelled dataset remaining:  197

100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 197/197 [00:02<00:00, 79.98it/s]



 98%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉    | 205/210 [00:06<00:00, 56.11it/s]
train loss = 0.026603026744227723
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 210/210 [00:07<00:00, 28.22it/s]




100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 290/290 [00:08<00:00, 34.04it/s]
AUC score for epoch 1 : 0.8335332274436951
Saving the best model
Best AUC score is 0.8335332274436951
Epoch 2



 96%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋       | 201/210 [00:07<00:00, 46.37it/s]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 210/210 [00:07<00:00, 27.19it/s]
  0%|                                                                                                                                                                                      | 0/290 [00:00<?, ?it/s]





100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 290/290 [00:10<00:00, 27.58it/s]
AUC score for epoch 2 : 0.8332842588424683
Best AUC score is 0.8335332274436951
Epoch 3



100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 210/210 [00:07<00:00, 26.63it/s]
  0%|                                                                                                                                                                                      | 0/290 [00:00<?, ?it/s]
train loss = 0.022990778015706124





100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 290/290 [00:09<00:00, 31.92it/s]
AUC score for epoch 3 : 0.8352939486503601
Saving the best model
Best AUC score is 0.8352939486503601
Epoch 4



100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 210/210 [00:07<00:00, 28.12it/s]
  0%|                                                                                                                                                                                      | 0/290 [00:00<?, ?it/s]
train loss = 0.01796128117452359





100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 290/290 [00:09<00:00, 31.94it/s]
AUC score for epoch 4 : 0.8340343832969666
Best AUC score is 0.8352939486503601
Epoch 5



100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 210/210 [00:08<00:00, 25.39it/s]
  0%|                                                                                                                                                                                      | 0/290 [00:00<?, ?it/s]
train loss = 0.018344981640915477





100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 290/290 [00:08<00:00, 33.94it/s]
AUC score for epoch 5 : 0.8364817500114441
Saving the best model
Best AUC score is 0.8364817500114441
Epoch 6



100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 210/210 [00:07<00:00, 27.29it/s]
  0%|                                                                                                                                                                                      | 0/290 [00:00<?, ?it/s]
train loss = 0.02390700108475617





100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 290/290 [00:08<00:00, 32.73it/s]
AUC score for epoch 6 : 0.8333290219306946
Best AUC score is 0.8364817500114441
Epoch 7



100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 210/210 [00:08<00:00, 25.74it/s]
  0%|                                                                                                                                                                                      | 0/290 [00:00<?, ?it/s]
train loss = 0.019753237970178902





100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 290/290 [00:09<00:00, 29.44it/s]
AUC score for epoch 7 : 0.8329895734786987
Best AUC score is 0.8364817500114441
Epoch 8




100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 210/210 [00:08<00:00, 25.94it/s]
train loss = 0.020675490359142366
Performing evaluation of epoch 8





100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 290/290 [00:10<00:00, 26.68it/s]
AUC score for epoch 8 : 0.8338302373886108
Best AUC score is 0.8364817500114441
Epoch 9



 97%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎     | 203/210 [00:06<00:00, 47.75it/s]
train loss = 0.009930533631337486
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 210/210 [00:07<00:00, 28.38it/s]





100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 290/290 [00:09<00:00, 30.16it/s]
AUC score for epoch 9 : 0.8316475749015808
Best AUC score is 0.8364817500114441
Epoch 10



100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 210/210 [00:07<00:00, 28.33it/s]
train loss = 0.011007194214159556
Performing evaluation of epoch 10





100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 290/290 [00:10<00:00, 28.49it/s]
  0%|                                                                                                                                                                                      | 0/197 [00:00<?, ?it/s]
AUC score for epoch 10 : 0.835722804069519
Best AUC score is 0.8364817500114441
BEST TEST AUC:  0.8364817500114441
Loading the best model


100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 197/197 [00:03<00:00, 51.38it/s]
################################
TOTAL EPOCH:  3
################################
Length of normal dataset:  839
Length of anomaly dataset:  839
Length of unlabelled dataset remaining:  197
Epoch 1
  1%|█▋                                                                                                                                                                         | 2/210 [04:00<6:57:13, 120.35s/it]
Traceback (most recent call last):
  File "main.py", line 289, in <module>
    best_auc, model = train_once(train_anomaly_dl, train_normal_dl, val_dl, train_bs, valid_bs, epochs, num_feats, curr_best_auc)
  File "main.py", line 141, in train_once
    loss = train(epoch, model, optimizer, device, [train_anomaly_dl, train_normal_dl], train_bs)
  File "main.py", line 33, in train
    for anomaly, normal in tqdm(zip(anomaly_dl, normal_dl), total=l):
  File "/local/scratch/v_eshaan_mandal/miniconda3/envs/clip_feats/lib/python3.8/site-packages/tqdm/std.py", line 1178, in __iter__
    for obj in iterable:
  File "/local/scratch/v_eshaan_mandal/miniconda3/envs/clip_feats/lib/python3.8/site-packages/torch/utils/data/dataloader.py", line 628, in __next__
    data = self._next_data()
  File "/local/scratch/v_eshaan_mandal/miniconda3/envs/clip_feats/lib/python3.8/site-packages/torch/utils/data/dataloader.py", line 1316, in _next_data
    idx, data = self._get_data()
  File "/local/scratch/v_eshaan_mandal/miniconda3/envs/clip_feats/lib/python3.8/site-packages/torch/utils/data/dataloader.py", line 1272, in _get_data
    success, data = self._try_get_data()
  File "/local/scratch/v_eshaan_mandal/miniconda3/envs/clip_feats/lib/python3.8/site-packages/torch/utils/data/dataloader.py", line 1120, in _try_get_data
    data = self._data_queue.get(timeout=timeout)
  File "/local/scratch/v_eshaan_mandal/miniconda3/envs/clip_feats/lib/python3.8/queue.py", line 179, in get
    self.not_empty.wait(remaining)
  File "/local/scratch/v_eshaan_mandal/miniconda3/envs/clip_feats/lib/python3.8/threading.py", line 306, in wait
    gotit = waiter.acquire(True, timeout)
KeyboardInterrupt